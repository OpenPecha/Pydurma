from pathlib import Path
from Pydurma.aligners.fdmp import FDMPaligner




def test_fdmp_aligner():

    token_strings = [
        '+,-./0123456789678-3',
        ',-./012345678:678-3',
        ';-./456789678-3'
    ]
    token_lists = [
        [
        (0, 5, 1, '༄༅། །'), (5, 10, 1, 'རིགས་'), (10, 12, 1, 'པ་'), (12, 17, 1, 'བསྟན་'), (17, 20, 1, 'པར་'), (20, 23, 1, 'བྱ་'), (23, 27, 1, 'བའི་'), (27, 31, 1, 'ཕྱིར'), (31, 33, 1, '། '), (33, 36, 1, 'དེ་'), 
        (36, 40, 1, 'ཉིད་'), (40, 44, 1, 'ཀྱི་'), (44, 48, 1, 'བཀྲ་'), (48, 52, 1, 'ཤིས་'), (52, 56, 1, 'ཀུན་'), (56, 60, 1, 'གྱི་'), (60, 64, 1, 'བཀྲ་'), (64, 68, 1, 'ཤིས་'), (68, 69, 1, 'པ'), (69, 70, 1, '།')
        ],
        [
        (0, 5, 1, 'རིགས་'), (5, 7, 1, 'པ་'), (7, 12, 1, 'བསྟན་'), (12, 15, 1, 'པར་'), (15, 18, 1, 'བྱ་'), (18, 22, 1, 'བའི་'), (22, 26, 1, 'ཕྱིར'), (26, 28, 1, '། '), (28, 31, 1, 'དེ་'), (31, 35, 1, 'ཉིད་'),
        (35, 39, 1, 'ཀྱི་'), (39, 43, 1, 'བཀྲ་'), (43, 47, 1, 'ཤིས་'), (47, 51, 1, 'ཀུད་'), (51, 55, 1, 'གྱི་'), (55, 59, 1, 'བཀྲ་'), (59, 63, 1, 'ཤིས་'), (63, 64, 1, 'པ'), (64, 65, 1, '།')
        ],
        [
        (0, 5, 1, 'རིག་'), (5, 7, 1, 'པ་'), (7, 12, 1, 'བསྟན་'), (12, 15, 1, 'པར་'), (15, 18, 1, 'དེ་'), (18, 22, 1, 'ཉིད་'), (22, 26, 1, 'ཀྱི་'), (26, 30, 1, 'བཀྲ་'), (30, 34, 1, 'ཤིས་'), (34, 38, 1, 'ཀུན་'),
        (38, 42, 1, 'ཀྱི་'), (42, 46, 1, 'བཀྲ་'), (46, 50, 1, 'ཤིས་'), (50, 51, 1, 'པ'), (51, 52, 1, '།')
        ]
    ]

    expected_matrix = [
        [(0, 10, 1, '༄༅། །རིགས་'), (0, 5, 1, 'རིགས་'), (0, 5, 1, 'རིག་')],
        [(10, 12, 1, 'པ་'), (5, 7, 1, 'པ་'), (5, 7, 1, 'པ་')],
        [(12, 17, 1, 'བསྟན་'), (7, 12, 1, 'བསྟན་'), (7, 12, 1, 'བསྟན་')],
        [(17, 33, 1, 'པར་བྱ་བའི་ཕྱིར། '), (12, 28, 1, 'པར་བྱ་བའི་ཕྱིར། '), (12, 15, 1, 'པར་')],
        [(33, 36, 1, 'དེ་'), (28, 31, 1, 'དེ་'), (15, 18, 1, 'དེ་')],
        [(36, 40, 1, 'ཉིད་'), (31, 35, 1, 'ཉིད་'), (18, 22, 1, 'ཉིད་')],
        [(40, 44, 1, 'ཀྱི་'), (35, 39, 1, 'ཀྱི་'), (22, 26, 1, 'ཀྱི་')],
        [(44, 48, 1, 'བཀྲ་'), (39, 43, 1, 'བཀྲ་'), (26, 30, 1, 'བཀྲ་')],
        [(48, 52, 1, 'ཤིས་'), (43, 47, 1, 'ཤིས་'), (30, 34, 1, 'ཤིས་')],
        [(52, 60, 1, 'ཀུན་གྱི་'), (47, 55, 1, 'ཀུད་གྱི་'), (34, 42, 1, 'ཀུན་ཀྱི་')],
        [(60, 64, 1, 'བཀྲ་'), (55, 59, 1, 'བཀྲ་'), (42, 46, 1, 'བཀྲ་')],
        [(64, 68, 1, 'ཤིས་'), (59, 63, 1, 'ཤིས་'), (46, 50, 1, 'ཤིས་')],
        [(68, 69, 1, 'པ'), (63, 64, 1, 'པ'), (50, 51, 1, 'པ')],
        [(69, 70, 1, '།'), (64, 65, 1, '།'), (51, 52, 1, '།')]
    ]

    aligner = FDMPaligner()
    token_matrix = aligner.get_alignment_matrix(token_strings, token_lists)
    
    assert expected_matrix == token_matrix
    

# test_fdmp_aligner()
